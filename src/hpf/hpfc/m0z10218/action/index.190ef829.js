!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("nc-lightapp-front")):"function"==typeof define&&define.amd?define(["nc-lightapp-front"],t):"object"==typeof exports?exports["hpf/hpfc/m0z10218/action/index"]=t(require("nc-lightapp-front")):e["hpf/hpfc/m0z10218/action/index"]=t(e["nc-lightapp-front"])}(window,(function(e){return function(e){var t={};function a(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(o,s,function(t){return e[t]}.bind(null,s));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="../../../../",a(a.s=58)}({0:function(t,a){t.exports=e},58:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initTemplate=function(e,t){var a=this;e.createUIDom({pagecode:n},(function(o){if(o){if(o.template){var s=o.template;s=b.call(a,e,s),e.meta.setMeta(s),o.context.pk_org&&(a.setState({pk_org:o.context.pk_org}),a.setState({org_name:o.context.org_Name})),f.call(a)}if(o.button){var n=o.button;e.button.setButtons(n),e.button.setButtonDisabled({Delete:!0}),e.button.setButtonDisabled({Edit:!0}),e.button.setPopContent("DelLine",a.state.json["M0Z10218-000019"])}}t()}))},t.onloaddata=function(){this.props.button.setButtonsVisible({Save:!1,Cancel:!1});var e={querycondition:{},pageInfo:this.props.editTable.getTablePageInfo("head"),pagecode:n,queryAreaCode:"search",oid:this.props.meta.getMeta().search.oid,querytype:"tree"};p.call(this,!1,e)},t.onClickButton=function(e,t){var a=this,l=e.editTable.getCheckedRows("head"),b=e.editTable.getTablePageInfo("head"),f=this.state.hasSearched&&1==this.state.hasSearched?e.search.getAllSearchData("search",!1):null,g=this.props.meta.getMeta().search.oid,y={pageInfo:b,querycondition:null==f?{}:f,pagecode:n,queryAreaCode:"search",oid:g,querytype:"tree"};switch(t){case"Add":e.editTable.setStatus("head","edit");var v=this.props.editTable.getNumberOfRows("head");e.editTable.addRow("head",v,!0),e.button.setButtonsVisible("Edit",!1),e.button.setMainButton("Add",!1);break;case"Cancel":(0,o.promptBox)({color:"warning",title:this.state.json["M0Z10218-000006"],content:this.state.json["M0Z10218-000007"],beSureBtnClick:function(){e.editTable.cancelEdit("head"),e.editTable.setStatus("head","browse"),e.button.setButtonDisabled("Edit",!0),e.button.setMainButton("Add",!0),e.button.setButtonDisabled("Delete",!0),c.call(a)}});break;case"Down":e.modal.show("selds");break;case"Save":e.editTable.filterEmptyRows("head",r);var m=e.editTable.getAllData("head");if(!m||0===m.length)return e.editTable.cancelEdit("head"),e.editTable.setStatus("head","browse"),e.button.setButtonsVisible("Edit",!0),e.button.setMainButton("Add",!0),void c.call(this);if(!e.editTable.checkRequired("head",m.rows))return;e.editTable.setStatus("head","browse");var w={pageid:n,model:{pageInfo:b,rows:m.rows,areaType:"table",areacode:"head"}};this.props.validateToSave(w,(function(){(0,o.ajax)({url:i.saveUrl,data:w,success:function(t){if(this.props.editTable.setStatus("head","browse"),t.data){var a=this.props.editTable.getAllData("head");!function(e,t){if(!t)return;e.rows&&e.rows.forEach((function(a,o){t.forEach((function(t,s){t.rowid===a.rowid&&(e.rows[o]=t)}))}))}(a,t.data.head.rows),this.props.editTable.setTableData("head",a),(0,o.toast)({color:"success",title:this.state.json["M0Z10218-000008"]})}e.button.setButtonDisabled("Edit",!0),e.button.setMainButton("Add",!0),e.button.setButtonDisabled("Delete",!0),c.call(this)}.bind(a)})}),s({},"head","editTable"),"grid");break;case"Delete":if(0!=l.length)if(e.editTable.getStatus("head")&&"edit"==e.editTable.getStatus("head")){var T=l.map((function(e){return e.index}));e.editTable.deleteTableRowsByIndex("head",T)}else{var S=l.map((function(e){return{status:"3",values:e.data.values}})),D={pageid:n,model:{areaType:"table",pageInfo:b,rows:S}};(0,o.promptBox)({color:"warning",title:this.state.json["M0Z10218-000009"],content:this.state.json["M0Z10218-000010"],beSureBtnClick:d.bind(this,D,y)})}else(0,o.promptBox)({color:"warning",title:this.state.json["M0Z10218-000011"],content:this.state.json["M0Z10218-000012"]});break;case"PrintGrp":case"Print":u.call(this);break;case"Output":h.call(this);break;case"Refresh":p.call(this,!1,y),(0,o.toast)({title:this.state.json["M0Z10218-000020"],color:"success"})}},t.onSelected=function(){var e=this.props.editTable.getCheckedRows("head"),t=!(e&&e.length>0);this.props.button.setButtonDisabled(["Delete"],t),this.props.button.setButtonDisabled(["Edit"],t),this.setState(this.state)},t.gridBeChecked=l,t.gridStatusChange=c,t.onClickPageInfo=function(e,t,a){var o=e.editTable.getTablePageInfo("head"),s=e.search.getAllSearchData("search"),n={pks:a,pageInfo:o,querycondition:s};p.call(this,!1,n,"pageQueryUrl")},t.onSearchAfterEvent=function(e){var t=e.search.getAllSearchData("search");if(t&&0!=t.conditions.length){var a=e.search.getSearchValByField("search","pk_org");if(a&&a.value&&a.value.firstvalue){var s=a.value.firstvalue;this.setState({dbinfo:null,pk_org:s})}e.editTable.getStatus()&&"edit"==e.editTable.getStatus()&&(0,o.promptBox)({color:"warning",title:this.state.json["M0Z10218-000011"],content:this.state.json["M0Z10218-000015"]});var r=this.props.meta.getMeta().search.oid,i={querycondition:null==t?{}:t,pageInfo:e.editTable.getTablePageInfo("head"),pagecode:n,queryAreaCode:"search",oid:r,querytype:"tree"};p.call(this,!0,i)}else this.setState({pk_org:""}),e.editTable.setTableData("head",{rows:[]},!1)},t.onClickSearchBtn=function(e,t){e.editTable.getStatus()&&"edit"==e.editTable.getStatus()&&(0,o.promptBox)({color:"warning",title:this.state.json["M0Z10218-000011"],content:this.state.json["M0Z10218-000015"]});var a=this.props.meta.getMeta().search.oid,s={querycondition:null==t?{}:t,pageInfo:e.editTable.getTablePageInfo("head"),pagecode:n,queryAreaCode:"search",oid:a,querytype:"tree"};p.call(this,!0,s)},t.beSureBtnClick=function(e){var t=this.state.dbinfo;if(0==Object.keys(t).length)return void(0,o.toast)({color:"warning",title:"来源系统不能为空!"});(0,o.ajax)({url:i.downUrl,data:{ref1:this.state.dbinfo},async:!1,success:function(t){var a=t.success,s=t.data;a?(0,o.toast)({color:"success",title:s}):(0,o.toast)({color:"success",title:"下载失败"}),e.modal.close("selds")}});e.editTable.getCheckedRows("head");var a=e.editTable.getTablePageInfo("head"),s=e.search.getAllSearchData("search",!1),r=this.props.meta.getMeta().search.oid,l={pageInfo:a,querycondition:null==s?{}:s,pagecode:n,queryAreaCode:"search",oid:r,querytype:"tree"};p.call(this,!1,l)},t.cancelBtnClick=function(){this.setState({pk_entryconfig:""})},t.setDefaultOrg=f;var o=a(0);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var n="M0Z10218_waitem",r=["iseucountry"],i={queryUrl:"/nccloud/hpf/waitem/WaitemQuery.do",pageQueryUrl:"/nccloud/hpf/waitem/WaitemQueryPageGridByPks.do",saveUrl:"/nccloud/hpf/waitem/WaitemSave.do",printUrl:"/nccloud/hpf/waitem/WaitemPrint.do",downUrl:"/nccloud/hpf/waitem/HpcfWaitemVODown.do"};function l(e){var t=e.editTable.getCheckedRows("head").length;e.button.setDisabled({btnDel:0===t})}function c(){var e=this.props.editTable.getStatus("head");this.props.button.setButtonsVisible({Save:"browse"!==e,Cancel:"browse"!==e,Add:"browse"===e,Edit:"browse"===e,Delete:"browse"===e,Refresh:"browse"===e,PrintGrp:"browse"===e,Output:"browse"===e}),this.props.button.setPopContent("DelLine","browse"===e?this.state.json["M0Z10218-000000"]:"")}function d(e,t){var a=this;(0,o.ajax)({url:i.saveUrl,data:e,success:function(e){e.success?(a.props.button.setButtonDisabled(["Delete"],!0),p.call(a,!1,t),(0,o.toast)({color:"success",title:a.state.json["M0Z10218-000002"]})):alert(e.message)}})}function u(){var e=this.props.editTable.getAllData("head");if(0!==e.length){var t=[];e.rows.forEach((function(e,a){t.push(e.values.pk_country.value)})),(0,o.print)("pdf",i.printUrl,{funcode:"M0Z10218",nodekey:null,oids:t})}else(0,o.toast)({content:this.state.json["M0Z10218-000013"],color:"warning"})}function h(){var e=this.props.editTable.getAllData("head");if(0!==e.length){var t=[];e.rows.forEach((function(e,a){t.push(e.values.true.value)})),this.setState({ids:t},this.refs.printOutput.open())}else(0,o.toast)({content:this.state.json["M0Z10218-000014"],color:"warning"})}function p(e,t,a){var n=this,r=this,l=null==a?"queryUrl":a;void 0!==t.querycondition.conditions&&(t.querycondition.conditions&&0==t.querycondition.conditions.length||(0,o.ajax)({url:i[l],data:t,success:function(t){var a=t.success,i=t.data;if(a){if(t.formulamsg&&t.formulamsg instanceof Array&&t.formulamsg.length>0&&r.props.dealFormulamsg(t.formulamsg,s({},"head","table")),t.hasOwnProperty("data")&&null!=i)r.props.editTable.setTableData("head",i.head),r.props.button.setButtonDisabled({PrintGrp:!1,Output:!1,Delete:!0,Edit:!0});else{r.props.editTable.setTableData("head",{rows:[]}),r.props.button.setButtonDisabled({PrintGrp:!0,Output:!0,Delete:!0,Edit:!0})}r.props.editTable.setStatus("browse"),!0===e&&(0,o.toast)({color:"success",content:n.state.json["M0Z10218-000003"]+i.head.allpks.length+n.state.json["M0Z10218-000004"]}),n.setState({hasSearched:!0})}},error:function(t){!0===e&&(0,o.toast)({color:"warning",content:n.state.json["M0Z10218-000005"]})}}))}function b(e,t){return t.head.showindex=!0,t.head.status="browse",t.head.pagination=!1,t.search.items.map((function(t){"pk_org"===t.attrcode&&(t.isMultiSelectedEnabled=!1,t.queryCondition=function(){return{funcode:e.getSearchParam("c"),TreeRefActionExt:"nccloud.web.refer.sqlbuilder.PrimaryOrgSQLBuilder"}})})),t}function f(){if(this.state.pk_org&&"GLOBLE00000000000000"!=this.state.pk_org){this.props.search.setSearchValByField("search","pk_org",{display:this.state.org_name,value:this.state.pk_org});var e=this.props.editTable.getTablePageInfo("head"),t=this.props.search.getAllSearchData("search",!1),a=this.props.meta.getMeta().search.oid,o={pageInfo:e,querycondition:null==t?{}:t,pagecode:n,queryAreaCode:"search",oid:a,querytype:"tree"};p.call(this,!1,o)}else this.props.search.setSearchValByField("search","pk_org",{display:"",value:""})}}})}));